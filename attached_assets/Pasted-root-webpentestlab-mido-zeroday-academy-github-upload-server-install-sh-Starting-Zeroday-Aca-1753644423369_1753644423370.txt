root@webpentestlab:~/mido/zeroday-academy/github-upload# ./server-install.sh
ðŸš€ Starting Zeroday Academy Server Installation...
==================================================
âŒ This script should not be run as root. Please run as a regular user with sudo privileges.
root@webpentestlab:~/mido/zeroday-academy/github-upload# su zeroday
zeroday@webpentestlab:/root/mido/zeroday-academy/github-upload$ ./server-install.sh
ðŸš€ Starting Zeroday Academy Server Installation...
==================================================
ðŸ“¦ Updating system packages...
Hit:1 http://mirrors.digitalocean.com/ubuntu oracular InRelease
Hit:2 http://mirrors.digitalocean.com/ubuntu oracular-updates InRelease
Hit:3 http://mirrors.digitalocean.com/ubuntu oracular-backports InRelease
Hit:4 https://deb.nodesource.com/node_20.x nodistro InRelease
Hit:5 https://repos-droplet.digitalocean.com/apt/droplet-agent main InRelease
Hit:6 http://security.ubuntu.com/ubuntu oracular-security InRelease
All packages are up to date.
Summary:
  Upgrading: 0, Installing: 0, Removing: 0, Not Upgrading: 0
ðŸ“¦ Installing Node.js 20...
âœ… Node.js 20+ already installed: v20.19.4
ðŸ“¦ Installing required system packages...
postgresql is already the newest version (16+262).
postgresql-contrib is already the newest version (16+262).
nginx is already the newest version (1.26.0-2ubuntu3.3).
git is already the newest version (1:2.45.2-1ubuntu1.2).
curl is already the newest version (8.9.1-2ubuntu2.2).
openssl is already the newest version (3.3.1-2ubuntu2.1).
ufw is already the newest version (0.36.2-6).
Summary:
  Upgrading: 0, Installing: 0, Removing: 0, Not Upgrading: 0
ðŸ“¦ Installing PM2 process manager...

changed 135 packages in 12s

13 packages are looking for funding
  run `npm fund` for details
ðŸ“ Creating application directory...
ðŸ“‹ Copying application files from current directory...
ðŸ“¦ Installing Node.js dependencies...

up to date, audited 507 packages in 3s

67 packages are looking for funding
  run `npm fund` for details

10 vulnerabilities (3 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
ðŸ—„ï¸  Setting up PostgreSQL database...
Synchronizing state of postgresql.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable postgresql
Database already exists
User exists, updating password...
ALTER ROLE
GRANT
ALTER DATABASE
âš™ï¸  Creating environment configuration...
ðŸ”¨ Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
Browserslist: browsers data (caniuse-lite) is 9 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
âœ“ 1687 modules transformed.
../dist/public/index.html                   0.94 kB â”‚ gzip:  0.54 kB
../dist/public/assets/index-CYv7x5DE.css   38.50 kB â”‚ gzip:  7.83 kB
../dist/public/assets/index-BjZ8ciSx.js   298.92 kB â”‚ gzip: 88.88 kB
âœ“ built in 14.19s
â–² [WARNING] Using direct eval with a bundler is not recommended and may cause problems [direct-eval]

    server/routes.ts:3014:25:
      3014 â”‚           const result = eval(mathMatch[1]);
           â•µ                          ~~~~

  You can read more about direct eval and bundling here: https://esbuild.github.io/link/direct-eval

1 warning

  dist/index.js  190.6kb

âš¡ Done in 34ms
ðŸ—„ï¸  Setting up database schema...

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/var/www/zeroday-academy/drizzle.config.ts'
Using 'pg' driver for database querying
[âœ“] Pulling schema from database...

 Warning  You are about to execute current statements:

CREATE TABLE "modules" (
        "id" text PRIMARY KEY NOT NULL,
        "title" text NOT NULL,
        "slug" text NOT NULL,
        "description" text NOT NULL,
        "icon" text NOT NULL,
        "created_at" timestamp DEFAULT now(),
        "updated_at" timestamp DEFAULT now(),
        CONSTRAINT "modules_slug_unique" UNIQUE("slug")
);

CREATE TABLE "sessions" (
        "sid" varchar PRIMARY KEY NOT NULL,
        "sess" jsonb NOT NULL,
        "expire" timestamp NOT NULL
);

CREATE TABLE "tasks" (
        "id" text PRIMARY KEY NOT NULL,
        "title" text NOT NULL,
        "module_id" text NOT NULL,
        "status" text NOT NULL,
        "objective" text NOT NULL,
        "tools_required" text[] NOT NULL,
        "instructions" text[] NOT NULL,
        "command_example" text,
        "command_output" text,
        "created_at" timestamp DEFAULT now(),
        "updated_at" timestamp DEFAULT now()
);

CREATE TABLE "tools" (
        "id" text PRIMARY KEY NOT NULL,
        "name" text NOT NULL,
        "icon" text NOT NULL,
        "description" text NOT NULL,
        "version" text NOT NULL,
        "type" text NOT NULL,
        "usage_instructions" text[] NOT NULL,
        "image_url" text NOT NULL,
        "created_at" timestamp DEFAULT now(),
        "updated_at" timestamp DEFAULT now()
);

CREATE TABLE "user_progress" (
        "id" text PRIMARY KEY NOT NULL,
        "user_id" varchar NOT NULL,
        "module_id" text NOT NULL,
        "completed_tasks" text[] NOT NULL,
        "notes" text,
        "last_accessed" timestamp DEFAULT now()
);

CREATE TABLE "users" (
        "id" varchar PRIMARY KEY NOT NULL,
        "email" varchar,
        "first_name" varchar,
        "last_name" varchar,
        "profile_image_url" varchar,
        "created_at" timestamp DEFAULT now(),
        "updated_at" timestamp DEFAULT now(),
        CONSTRAINT "users_email_unique" UNIQUE("email")
);

CREATE TABLE "vulnerabilities" (
        "id" text PRIMARY KEY NOT NULL,
        "module_id" text NOT NULL,
        "name" text NOT NULL,
        "description" text NOT NULL,
        "endpoint" text NOT NULL,
        "payload" text NOT NULL,
        "is_active" boolean DEFAULT true NOT NULL,
        "created_at" timestamp DEFAULT now(),
        "updated_at" timestamp DEFAULT now()
);

CREATE INDEX "IDX_session_expire" ON "sessions" USING btree ("expire");

[x] All changes were aborted
ðŸ”„ Configuring PM2 process manager...
ðŸš€ Starting application with PM2...

                        -------------

__/\\\\\\\\\\\\\____/\\\\____________/\\\\____/\\\\\\\\\_____
 _\/\\\/////////\\\_\/\\\\\\________/\\\\\\__/\\\///////\\\___
  _\/\\\_______\/\\\_\/\\\//\\\____/\\\//\\\_\///______\//\\\__
   _\/\\\\\\\\\\\\\/__\/\\\\///\\\/\\\/_\/\\\___________/\\\/___
    _\/\\\/////////____\/\\\__\///\\\/___\/\\\________/\\\//_____
     _\/\\\_____________\/\\\____\///_____\/\\\_____/\\\//________
      _\/\\\_____________\/\\\_____________\/\\\___/\\\/___________
       _\/\\\_____________\/\\\_____________\/\\\__/\\\\\\\\\\\\\\\_
        _\///______________\///______________\///__\///////////////__


                          Runtime Edition

        PM2 is a Production Process Manager for Node.js applications
                     with a built-in Load Balancer.

                Start and Daemonize any application:
                $ pm2 start app.js

                Load Balance 4 instances of api.js:
                $ pm2 start api.js -i 4

                Monitor in production:
                $ pm2 monitor

                Make pm2 auto-boot at server restart:
                $ pm2 startup

                To go further checkout:
                http://pm2.io/


                        -------------

[PM2] Spawning PM2 daemon with pm2_home=/home/zeroday/.pm2
[PM2] PM2 Successfully daemonized
[PM2][ERROR] File ecosystem.config.js malformated
ReferenceError: module is not defined
    at file:///var/www/zeroday-academy/ecosystem.config.js:1:1
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:387:35)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:323:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1371:24)
    at Module._compile (node:internal/modules/cjs/loader:1511:5)
    at Module._extensions..js (node:internal/modules/cjs/loader:1572:16)
    at Module.load (node:internal/modules/cjs/loader:1275:32)
    at Module._load (node:internal/modules/cjs/loader:1096:12)
    at Module.require (node:internal/modules/cjs/loader:1298:19)
    at require (node:internal/modules/helpers:182:18)